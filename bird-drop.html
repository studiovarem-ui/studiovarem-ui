<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BIRD DROP</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
        }
        #gameCanvas {
            display: block;
            width: 100%;
            height: 100%;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <script>
        // ============================================
        // BIRD DROP - MVP Version
        // ============================================

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Game constants
        const BIRD_AREA_PERCENT = 0.35;
        const GROUND_HEIGHT = 60;
        const POOP_SPEED = 8;
        const HUMAN_SPAWN_INTERVAL = 1500;
        const ENERGY_MAX = 100;
        const ENERGY_COST = 8;
        const ENERGY_REGEN = 0.5;
        const COMBO_TIMEOUT = 2000;

        // Game state
        let gameState = 'MENU'; // MENU, PLAYING, GAME_OVER
        let score = 0;
        let combo = 0;
        let lastHitTime = 0;
        let highScore = 0;

        // Canvas sizing
        let W, H;
        let scale = 1;

        // Bird
        const bird = {
            x: 0,
            y: 0,
            width: 24,
            height: 24,
            energy: ENERGY_MAX,
            hp: 3
        };

        // Arrays
        let poops = [];
        let humans = [];
        let particles = [];

        // Touch controls
        let touchLeft = null;
        let touchRight = null;
        let joystickBase = { x: 0, y: 0 };
        let joystickPos = { x: 0, y: 0 };
        let isPooping = false;
        let lastPoopTime = 0;
        const POOP_COOLDOWN = 150;

        // Timers
        let lastHumanSpawn = 0;

        // ============================================
        // PIXEL ART SPRITES
        // ============================================

        // Bird sprite (24x24) - cute brown sparrow
        const BIRD_SPRITE = [
            '........####............',
            '......##BBBB##..........',
            '.....#BBBBBBBB#.........',
            '....#BBBBBBBBBB#........',
            '...#BBBWWBBBBBB#........',
            '...#BBWWWWBBBBB##.......',
            '..#BBBWWKKBBBBBB#.......',
            '..#BBBBKKBBBBBBB#.......',
            '..#BBBBBBBBBBBBB#.......',
            '..#BBBBBBBBBOOOOB#......',
            '..#BBBBBBBBOOOOOOB#.....',
            '...#BBBBBBBOOOOOBB#.....',
            '...#BBBBBBBBOOOBBB#.....',
            '....#BBBBBBBBBBBB#......',
            '....#BBBBBBBBBBB#.......',
            '.....#BBBBBBBBBB#.......',
            '......#BBBBBBBB#........',
            '.......##BBBB##.........',
            '.........#BB#...........',
            '........#OOOOO#.........',
            '........#OO#OO#.........',
            '.........##.##..........',
            '........................',
            '........................'
        ];

        // Human sprite (16x32) - walking person
        const HUMAN_SPRITES = [
            // Type 0: Normal person (pink shirt)
            [
                '......####......',
                '....########....',
                '...##SSSSSS##...',
                '...#SSSSSSSS#...',
                '...#SSSSSSSS#...',
                '....##SSSS##....',
                '.....#SSSS#.....',
                '....########....',
                '...#PPPPPPPP#...',
                '..#PPPPPPPPPP#..',
                '..#PPPPPPPPPP#..',
                '..#SSPPPPPPSS#..',
                '...#PPPPPPPP#...',
                '...#PPPPPPPP#...',
                '....#PPPPPP#....',
                '....#PPPPPP#....',
                '....#PPPPPP#....',
                '.....#NNNN#.....',
                '.....#NNNN#.....',
                '.....#N##N#.....',
                '....#NN##NN#....',
                '....#NN##NN#....',
                '....#NN..NN#....',
                '.....##..##.....',
                '.....##..##.....',
                '....#KK..KK#....',
                '....#KK..KK#....',
                '...#KKK..KKK#...',
                '...#KKK..KKK#...',
                '...####..####...',
                '................',
                '................'
            ],
            // Type 1: Runner (green)
            [
                '......####......',
                '....########....',
                '...##SSSSSS##...',
                '...#SSSSSSSS#...',
                '...#SSSSSSSS#...',
                '....##SSSS##....',
                '.....#SSSS#.....',
                '....########....',
                '...#GGGGGGGG#...',
                '..#GGGGGGGGGG#..',
                '..#GGGGGGGGGG#..',
                '..#SSGGGGGGSS#..',
                '...#GGGGGGGG#...',
                '...#GGGGGGGG#...',
                '....#GGGGGG#....',
                '....#GGGGGG#....',
                '....#GGGGGG#....',
                '.....#NNNN#.....',
                '.....#NNNN#.....',
                '.....#N##N#.....',
                '....#NN##NN#....',
                '....#NN##NN#....',
                '....#NN..NN#....',
                '.....##..##.....',
                '.....##..##.....',
                '....#WW..WW#....',
                '....#WW..WW#....',
                '...#WWW..WWW#...',
                '...#WWW..WWW#...',
                '...####..####...',
                '................',
                '................'
            ],
            // Type 2: Child (yellow)
            [
                '......####......',
                '....########....',
                '...##YYYY####...',
                '...#SSSSSSSS#...',
                '...#SSSSSSSS#...',
                '....##SSSS##....',
                '.....#SSSS#.....',
                '....########....',
                '...#YYYYYYYY#...',
                '..#YYYYYYYYYY#..',
                '..#YYYYYYYYYY#..',
                '..#SSYYYYYYSS#..',
                '...#YYYYYYYY#...',
                '...#YYYYYYYY#...',
                '....#YYYYYY#....',
                '....#YYYYYY#....',
                '....#YYYYYY#....',
                '.....#NNNN#.....',
                '.....#NNNN#.....',
                '.....#N##N#.....',
                '....#NN##NN#....',
                '....#NN##NN#....',
                '....#NN..NN#....',
                '.....##..##.....',
                '.....##..##.....',
                '....#RR..RR#....',
                '....#RR..RR#....',
                '...#RRR..RRR#...',
                '...#RRR..RRR#...',
                '...####..####...',
                '................',
                '................'
            ]
        ];

        // Poop sprite (8x8)
        const POOP_SPRITE = [
            '...##...',
            '..####..',
            '.#CC###.',
            '#CCCCCC#',
            '#CCBBCC#',
            '#CCCCCC#',
            '.#CCCC#.',
            '..####..'
        ];

        // Color palette
        const COLORS = {
            '.': 'transparent',
            '#': '#2a1a0a',
            'B': '#A0722A',
            'W': '#FFFFFF',
            'K': '#000000',
            'O': '#FF8C00',
            'S': '#FFDAB9',
            'P': '#FFB6C1',
            'G': '#32CD32',
            'Y': '#FFD700',
            'N': '#4169E1',
            'R': '#FF4444',
            'C': '#8B4513',
            'b': '#654321',
            'w': '#EEEEEE'
        };

        // ============================================
        // SPRITE RENDERING
        // ============================================

        function drawSprite(sprite, x, y, pixelSize, colors = COLORS) {
            for (let row = 0; row < sprite.length; row++) {
                for (let col = 0; col < sprite[row].length; col++) {
                    const char = sprite[row][col];
                    const color = colors[char];
                    if (color && color !== 'transparent') {
                        ctx.fillStyle = color;
                        ctx.fillRect(
                            Math.floor(x + col * pixelSize),
                            Math.floor(y + row * pixelSize),
                            pixelSize,
                            pixelSize
                        );
                    }
                }
            }
        }

        // ============================================
        // RESIZE HANDLER
        // ============================================

        function resize() {
            const dpr = window.devicePixelRatio || 1;
            W = window.innerWidth;
            H = window.innerHeight;
            canvas.width = W * dpr;
            canvas.height = H * dpr;
            canvas.style.width = W + 'px';
            canvas.style.height = H + 'px';
            ctx.setTransform(1, 0, 0, 1, 0, 0);
            ctx.scale(dpr, dpr);
            scale = Math.min(W / 360, H / 640);

            if (bird.x === 0) {
                bird.x = W / 2;
                bird.y = H * 0.2;
            }

            joystickBase.x = 80 * scale;
            joystickBase.y = H - 100 * scale;
        }

        // ============================================
        // TOUCH HANDLERS
        // ============================================

        function handleTouchStart(e) {
            e.preventDefault();
            for (let touch of e.changedTouches) {
                const x = touch.clientX;
                const y = touch.clientY;

                if (gameState === 'MENU') {
                    gameState = 'PLAYING';
                    resetGame();
                    return;
                }

                if (gameState === 'GAME_OVER') {
                    gameState = 'MENU';
                    return;
                }

                if (x < W / 2) {
                    touchLeft = touch.identifier;
                    joystickPos.x = x;
                    joystickPos.y = y;
                    joystickBase.x = x;
                    joystickBase.y = y;
                } else {
                    touchRight = touch.identifier;
                    isPooping = true;
                }
            }
        }

        function handleTouchMove(e) {
            e.preventDefault();
            for (let touch of e.changedTouches) {
                if (touch.identifier === touchLeft) {
                    joystickPos.x = touch.clientX;
                    joystickPos.y = touch.clientY;
                }
            }
        }

        function handleTouchEnd(e) {
            e.preventDefault();
            for (let touch of e.changedTouches) {
                if (touch.identifier === touchLeft) {
                    touchLeft = null;
                    joystickPos.x = joystickBase.x;
                    joystickPos.y = joystickBase.y;
                }
                if (touch.identifier === touchRight) {
                    touchRight = null;
                    isPooping = false;
                }
            }
        }

        // Keyboard support
        const keys = {};
        function handleKeyDown(e) {
            keys[e.code] = true;
            if (gameState === 'MENU' && e.code === 'Space') {
                gameState = 'PLAYING';
                resetGame();
            }
            if (gameState === 'GAME_OVER' && e.code === 'Space') {
                gameState = 'MENU';
            }
        }
        function handleKeyUp(e) {
            keys[e.code] = false;
        }

        // ============================================
        // GAME LOGIC
        // ============================================

        function resetGame() {
            bird.x = W / 2;
            bird.y = H * 0.2;
            bird.energy = ENERGY_MAX;
            bird.hp = 3;
            score = 0;
            combo = 0;
            poops = [];
            humans = [];
            particles = [];
            lastHumanSpawn = Date.now();
        }

        function spawnHuman() {
            const type = Math.floor(Math.random() * 3);
            const fromLeft = Math.random() > 0.5;
            const speeds = [1.5, 3, 2];
            const points = [10, 25, 20];

            humans.push({
                x: fromLeft ? -20 : W + 20,
                y: H - GROUND_HEIGHT - 64 * scale,
                width: 16,
                height: 32,
                type: type,
                speed: speeds[type] * scale * (fromLeft ? 1 : -1),
                points: points[type],
                hit: false
            });
        }

        function shootPoop() {
            const now = Date.now();
            if (now - lastPoopTime < POOP_COOLDOWN) return;
            if (bird.energy < ENERGY_COST) return;

            bird.energy -= ENERGY_COST;
            lastPoopTime = now;

            poops.push({
                x: bird.x,
                y: bird.y + bird.height,
                width: 8,
                height: 8,
                speed: POOP_SPEED * scale
            });
        }

        function createSplat(x, y) {
            for (let i = 0; i < 8; i++) {
                const angle = (Math.PI * 2 / 8) * i;
                particles.push({
                    x: x,
                    y: y,
                    vx: Math.cos(angle) * 3 * scale,
                    vy: Math.sin(angle) * 3 * scale,
                    life: 30,
                    color: '#8B4513'
                });
            }
        }

        function update() {
            if (gameState !== 'PLAYING') return;

            const now = Date.now();

            // Bird movement from joystick
            if (touchLeft !== null) {
                const dx = joystickPos.x - joystickBase.x;
                const dy = joystickPos.y - joystickBase.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                const maxDist = 50 * scale;

                if (dist > 5) {
                    const speed = Math.min(dist / maxDist, 1) * 5 * scale;
                    bird.x += (dx / dist) * speed;
                    bird.y += (dy / dist) * speed;
                }
            }

            // Keyboard movement
            const moveSpeed = 5 * scale;
            if (keys['ArrowLeft'] || keys['KeyA']) bird.x -= moveSpeed;
            if (keys['ArrowRight'] || keys['KeyD']) bird.x += moveSpeed;
            if (keys['ArrowUp'] || keys['KeyW']) bird.y -= moveSpeed;
            if (keys['ArrowDown'] || keys['KeyS']) bird.y += moveSpeed;

            // Constrain bird to upper area
            const maxY = H * BIRD_AREA_PERCENT;
            bird.x = Math.max(bird.width, Math.min(W - bird.width, bird.x));
            bird.y = Math.max(bird.height, Math.min(maxY, bird.y));

            // Shooting
            if (isPooping || keys['Space']) {
                shootPoop();
            }

            // Energy regen
            bird.energy = Math.min(ENERGY_MAX, bird.energy + ENERGY_REGEN);

            // Combo timeout
            if (combo > 0 && now - lastHitTime > COMBO_TIMEOUT) {
                combo = 0;
            }

            // Spawn humans
            if (now - lastHumanSpawn > HUMAN_SPAWN_INTERVAL) {
                spawnHuman();
                lastHumanSpawn = now;
            }

            // Update poops
            for (let i = poops.length - 1; i >= 0; i--) {
                const poop = poops[i];
                poop.y += poop.speed;

                if (poop.y > H) {
                    poops.splice(i, 1);
                    continue;
                }

                // Check collision with humans
                for (let j = humans.length - 1; j >= 0; j--) {
                    const human = humans[j];
                    if (human.hit) continue;

                    const hx = human.x;
                    const hy = human.y;
                    const hw = human.width * 2 * scale;
                    const hh = human.height * 2 * scale;

                    if (poop.x > hx - hw/2 && poop.x < hx + hw/2 &&
                        poop.y > hy && poop.y < hy + hh) {
                        human.hit = true;
                        poops.splice(i, 1);

                        combo++;
                        lastHitTime = now;

                        const multiplier = 1 + (combo - 1) * 0.1;
                        const points = Math.floor(human.points * multiplier);
                        score += points;

                        createSplat(poop.x, poop.y);
                        break;
                    }
                }
            }

            // Update humans
            for (let i = humans.length - 1; i >= 0; i--) {
                const human = humans[i];
                human.x += human.speed;

                if (human.x < -50 || human.x > W + 50 || human.hit) {
                    humans.splice(i, 1);
                }
            }

            // Update particles
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.2 * scale;
                p.life--;
                if (p.life <= 0) {
                    particles.splice(i, 1);
                }
            }
        }

        // ============================================
        // RENDERING
        // ============================================

        function drawBackground() {
            // Sky gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, H);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(0.5, '#B0E0E6');
            gradient.addColorStop(1, '#98FB98');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, W, H);

            // Clouds
            ctx.fillStyle = '#FFFFFF';
            const time = Date.now() / 50;
            for (let i = 0; i < 5; i++) {
                const cx = ((time + i * 200) % (W + 100)) - 50;
                const cy = 50 + i * 40 * scale;
                drawCloud(cx, cy, 30 + i * 10);
            }

            // Ground
            ctx.fillStyle = '#8FBC8F';
            ctx.fillRect(0, H - GROUND_HEIGHT, W, GROUND_HEIGHT);

            // Path
            ctx.fillStyle = '#D2B48C';
            ctx.fillRect(0, H - GROUND_HEIGHT, W, 20 * scale);
        }

        function drawCloud(x, y, size) {
            const s = size * scale;
            ctx.beginPath();
            ctx.arc(x, y, s * 0.5, 0, Math.PI * 2);
            ctx.arc(x + s * 0.4, y - s * 0.2, s * 0.4, 0, Math.PI * 2);
            ctx.arc(x + s * 0.8, y, s * 0.5, 0, Math.PI * 2);
            ctx.arc(x + s * 0.4, y + s * 0.2, s * 0.35, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawBird() {
            const pixelSize = 2 * scale;
            const spriteW = 24 * pixelSize;
            const spriteH = 24 * pixelSize;
            drawSprite(BIRD_SPRITE, bird.x - spriteW/2, bird.y - spriteH/2, pixelSize);
        }

        function drawHumans() {
            const pixelSize = 2 * scale;
            for (const human of humans) {
                if (!human.hit) {
                    const sprite = HUMAN_SPRITES[human.type];
                    const spriteW = 16 * pixelSize;
                    const spriteH = 32 * pixelSize;
                    drawSprite(sprite, human.x - spriteW/2, human.y, pixelSize);
                }
            }
        }

        function drawPoops() {
            const pixelSize = 2 * scale;
            for (const poop of poops) {
                const spriteW = 8 * pixelSize;
                const spriteH = 8 * pixelSize;
                drawSprite(POOP_SPRITE, poop.x - spriteW/2, poop.y - spriteH/2, pixelSize);
            }
        }

        function drawParticles() {
            for (const p of particles) {
                ctx.fillStyle = p.color;
                const size = 4 * scale * (p.life / 30);
                ctx.fillRect(p.x - size/2, p.y - size/2, size, size);
            }
        }

        function drawUI() {
            // Energy bar background
            const barX = 20 * scale;
            const barY = 20 * scale;
            const barW = 120 * scale;
            const barH = 16 * scale;

            ctx.fillStyle = '#333';
            ctx.fillRect(barX - 2, barY - 2, barW + 4, barH + 4);
            ctx.fillStyle = '#555';
            ctx.fillRect(barX, barY, barW, barH);
            ctx.fillStyle = '#FFD700';
            ctx.fillRect(barX, barY, barW * (bird.energy / ENERGY_MAX), barH);

            // HP hearts
            const heartSize = 20 * scale;
            for (let i = 0; i < 3; i++) {
                ctx.fillStyle = i < bird.hp ? '#FF4444' : '#444';
                drawHeart(barX + i * (heartSize + 5), barY + barH + 10, heartSize);
            }

            // Score
            ctx.fillStyle = '#FFF';
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 3 * scale;
            ctx.font = `bold ${24 * scale}px monospace`;
            ctx.textAlign = 'right';
            const scoreText = score.toString().padStart(6, '0');
            ctx.strokeText(scoreText, W - 20 * scale, 36 * scale);
            ctx.fillText(scoreText, W - 20 * scale, 36 * scale);

            // Combo
            if (combo >= 2) {
                ctx.fillStyle = '#FF6600';
                ctx.font = `bold ${20 * scale}px monospace`;
                ctx.textAlign = 'center';
                const comboText = 'x' + combo + ' COMBO';
                ctx.strokeText(comboText, W / 2, 60 * scale);
                ctx.fillText(comboText, W / 2, 60 * scale);
            }

            // Joystick indicator
            if (touchLeft !== null) {
                ctx.globalAlpha = 0.3;
                ctx.fillStyle = '#FFF';
                ctx.beginPath();
                ctx.arc(joystickBase.x, joystickBase.y, 50 * scale, 0, Math.PI * 2);
                ctx.fill();

                ctx.globalAlpha = 0.5;
                ctx.beginPath();
                ctx.arc(joystickPos.x, joystickPos.y, 25 * scale, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1;
            }

            // Poop button hint
            ctx.globalAlpha = 0.2;
            ctx.fillStyle = '#8B4513';
            ctx.beginPath();
            ctx.arc(W - 80 * scale, H - 100 * scale, 50 * scale, 0, Math.PI * 2);
            ctx.fill();
            ctx.globalAlpha = 1;
        }

        function drawHeart(x, y, size) {
            ctx.beginPath();
            const topY = y + size * 0.3;
            ctx.moveTo(x + size/2, y + size);
            ctx.bezierCurveTo(x, y + size * 0.7, x, topY, x + size/4, topY);
            ctx.bezierCurveTo(x + size/2, topY - size * 0.2, x + size/2, topY, x + size/2, y + size * 0.5);
            ctx.bezierCurveTo(x + size/2, topY, x + size/2, topY - size * 0.2, x + size * 0.75, topY);
            ctx.bezierCurveTo(x + size, topY, x + size, y + size * 0.7, x + size/2, y + size);
            ctx.fill();
        }

        function drawMenu() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
            ctx.fillRect(0, 0, W, H);

            // Title
            ctx.fillStyle = '#FFD700';
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 4 * scale;
            ctx.font = `bold ${48 * scale}px monospace`;
            ctx.textAlign = 'center';
            ctx.strokeText('BIRD DROP', W/2, H * 0.3);
            ctx.fillText('BIRD DROP', W/2, H * 0.3);

            // Bird preview
            const pixelSize = 4 * scale;
            drawSprite(BIRD_SPRITE, W/2 - 48 * scale, H * 0.4, pixelSize);

            // Instructions
            ctx.fillStyle = '#FFF';
            ctx.font = `${18 * scale}px monospace`;
            ctx.fillText('TAP TO START', W/2, H * 0.7);

            ctx.font = `${14 * scale}px monospace`;
            ctx.fillStyle = '#AAA';
            ctx.fillText('Left: Move  |  Right: Poop', W/2, H * 0.78);

            if (highScore > 0) {
                ctx.fillStyle = '#FFD700';
                ctx.fillText('HIGH SCORE: ' + highScore, W/2, H * 0.86);
            }
        }

        function drawGameOver() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, W, H);

            ctx.fillStyle = '#FF4444';
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 4 * scale;
            ctx.font = `bold ${40 * scale}px monospace`;
            ctx.textAlign = 'center';
            ctx.strokeText('GAME OVER', W/2, H * 0.35);
            ctx.fillText('GAME OVER', W/2, H * 0.35);

            ctx.fillStyle = '#FFF';
            ctx.font = `${24 * scale}px monospace`;
            ctx.fillText('SCORE: ' + score, W/2, H * 0.5);

            if (score > highScore) {
                highScore = score;
                ctx.fillStyle = '#FFD700';
                ctx.fillText('NEW HIGH SCORE!', W/2, H * 0.58);
            }

            ctx.fillStyle = '#AAA';
            ctx.font = `${16 * scale}px monospace`;
            ctx.fillText('TAP TO CONTINUE', W/2, H * 0.75);
        }

        function render() {
            ctx.clearRect(0, 0, W, H);

            drawBackground();

            if (gameState === 'PLAYING') {
                drawHumans();
                drawPoops();
                drawParticles();
                drawBird();
                drawUI();
            } else if (gameState === 'MENU') {
                drawMenu();
            } else if (gameState === 'GAME_OVER') {
                drawHumans();
                drawPoops();
                drawBird();
                drawUI();
                drawGameOver();
            }
        }

        // ============================================
        // GAME LOOP
        // ============================================

        function gameLoop() {
            update();
            render();
            requestAnimationFrame(gameLoop);
        }

        // ============================================
        // INITIALIZATION
        // ============================================

        function init() {
            resize();
            window.addEventListener('resize', resize);

            canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
            canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
            canvas.addEventListener('touchend', handleTouchEnd, { passive: false });
            canvas.addEventListener('touchcancel', handleTouchEnd, { passive: false });

            document.addEventListener('keydown', handleKeyDown);
            document.addEventListener('keyup', handleKeyUp);

            canvas.addEventListener('contextmenu', e => e.preventDefault());

            gameLoop();
        }

        init();
    </script>
</body>
</html>
